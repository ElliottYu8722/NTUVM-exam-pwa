<!doctype html>
<html lang="zh-Hant-TW">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>獸醫師國考（PWA）</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#000000"/>
  <style>
    :root{
      --bg:#111; --fg:#fff; --muted:#aaa; --card:#1b1b1b; --border:#2a2a2a; --accent:#2f74ff;
      --btn:#222; --btn-fg:#fff; --pill:#2a2a2a;
    }
    body{margin:0;font-family:-apple-system, BlinkMacSystemFont, "SF Pro Text", "Noto Sans TC", Segoe UI, Roboto, Helvetica, Arial, "PingFang TC", "Heiti TC", "Microsoft JhengHei", sans-serif;background:var(--bg);color:var(--fg);}
    .light{--bg:#fff;--fg:#000;--card:#f7f7f8;--border:#e5e5e6;--muted:#666;--btn:#f1f1f1;--btn-fg:#000;--pill:#ececec;}
    .app{display:grid;grid-template-columns:240px 1fr 280px;gap:16px;min-height:100vh;align-items:start;padding:16px}
    .panel{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px}
    .left .group{display:flex;flex-direction:column;gap:10px;margin-bottom:16px}
    .select, .btn, .checkbox{font-size:16px}
    .select{width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:var(--pill);color:var(--fg)}
    .btn{padding:10px 14px;border-radius:9999px;border:1px solid var(--border);background:transparent;color:var(--fg);cursor:pointer}
    .btn:hover{border-color:var(--accent);color:var(--accent)}
    .checkbox{display:flex;align-items:center;gap:8px;color:var(--fg)}
    .center .topbar{display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin-bottom:12px}
    .badge{padding:6px 10px;border:1px solid var(--border);border-radius:9999px;background:transparent;color:var(--fg);font-size:14px}
    .question-card{border-radius:16px;border:1px solid var(--border);padding:16px;background:var(--card)}
    .qtext{font-size:18px;line-height:1.6}
    .qimg{margin-top:10px;max-width:100%;height:auto;border-radius:8px;border:1px solid var(--border)}
    .options{margin-top:10px;display:flex;flex-direction:column;gap:8px}
    .navrow{display:flex;gap:8px;align-items:center;margin-top:14px}
    .spacer{flex:1}
    .right .q-list{height:70vh;overflow:auto;border-radius:12px;border:1px solid var(--border);background:var(--card);padding:8px}
    .q-item{padding:8px 10px;border-radius:8px;cursor:pointer}
    .q-item.active{background:var(--accent);color:#fff}
    .notes{margin-top:14px}
    .toolbar{display:flex;flex-wrap:wrap;gap:6px;align-items:center;border:1px solid var(--border);border-radius:10px;background:transparent;padding:6px}
    .toolbar .pill{padding:6px 10px;border-radius:9999px;border:1px solid var(--border);background:transparent;color:var(--fg);cursor:pointer;font-size:14px}
    .toolbar .pill.active{border-color:var(--accent);color:var(--accent)}
    .toolbar select, .toolbar input[type=color]{border:1px solid var(--border);background:transparent;color:var(--fg);border-radius:8px;padding:6px 8px}
    .editor{border:1px solid var(--border);border-radius:12px;background:var(--card);min-height:180px;padding:12px;margin-top:8px;outline:none}
    .timer{font-weight:700}
    .footer-hint{margin-top:12px;color:var(--muted);font-size:12px;text-align:center}
    .hidden{display:none !important}
    /* mobile */
    @media (max-width: 1100px){
      .app{grid-template-columns:1fr}
      .right{order:3}
    }
  </style>
</head>
<body class="">
  <div class="app" id="app">
    <!-- 左：工具列 -->
    <aside class="left panel">
      <div class="group">
        <select id="yearSel" class="select">
          <option>109</option><option>110</option><option>111</option><option>112</option><option selected>113</option>
        </select>
        <select id="roundSel" class="select">
          <option selected>第一次</option><option>第二次</option>
        </select>
        <select id="subjectSel" class="select">
          <option value="獸醫病理學" selected>獸醫病理學</option>
          <option value="獸醫藥理學">獸醫藥理學</option>
          <option value="獸醫實驗診斷學">獸醫實驗診斷學</option>
          <option value="獸醫普通疾病學">獸醫普通疾病學</option>
          <option value="獸醫傳染病學">獸醫傳染病學</option>
          <option value="獸醫公共衛生學">獸醫公共衛生學</option>
        </select>
      </div>

      <label class="checkbox"><input id="showAns" type="checkbox">顯示答案</label>
      <button id="btnExam" class="btn">測驗模式</button>
      <button id="btnRecords" class="btn">作答紀錄</button>
      <button id="btnTheme" class="btn">深色 / 淺色</button>

      <hr style="border:none;border-top:1px solid var(--border);margin:16px 0">
      <div class="group">
        <input id="qFile" class="hidden" type="file" accept="application/json">
        <input id="aFile" class="hidden" type="file" accept="application/json">
      </div>
      <p style="color:var(--muted);font-size:12px;line-height:1.6">
      </p>
    </aside>

    <!-- 中：題目＋筆記 -->
    <main class="center">
      <div class="topbar">
        <span class="badge">科目：<span id="bSubj">獸醫病理學</span></span>
        <span class="badge">年份：<span id="bYear">113</span></span>
        <span class="badge">梯次：<span id="bRound">第一</span></span>
        <span class="badge timer hidden" id="timer">剩餘 60:00</span>
        <span class="badge hidden" id="reviewTag">回顧模式（僅看錯題）</span>
        <span class="spacer"></span>
        <button id="btnSubmit" class="btn hidden">提交測驗</button>
        <button id="btnClose" class="btn hidden">關閉測驗</button>
      </div>

      <div class="question-card">
        <div id="qNum" class="badge" style="margin-bottom:8px">第 1 題</div>
        <div id="qText" class="qtext">請先載入題目</div>
        <img id="qImg" class="qimg hidden" alt="">
        <div id="qOpts" class="options"></div>

        <div class="navrow">
          <button id="prev" class="btn">上一題</button>
          <button id="next" class="btn">下一題</button>
          <span class="spacer"></span>
          <button id="btnToggleAns" class="btn">切換顯示答案</button>
        </div>
      </div>

      <div class="notes">
        <div class="toolbar">
          <select id="fontSel">
            <option>12</option><option>14</option><option selected>16</option>
            <option>18</option><option>20</option><option>24</option><option>28</option><option>32</option>
          </select>
          <button class="pill" id="bBold"><b>B</b></button>
          <button class="pill" id="bItalic"><i>I</i></button>
          <button class="pill" id="bUnder"><u>U</u></button>
          <button class="pill" id="bSub">x₂</button>
          <button class="pill" id="bSup">x²</button>
          <input id="txtColor" type="color" value="#222222" />
          <input id="hlColor"  type="color" value="#fff59d" />
          <button class="pill" id="bHL">螢光筆</button>
          <input id="imgNote" type="file" accept="image/*" class="hidden">
          <button class="pill" id="bImg">插入圖片</button>
        </div>
        <div id="editor" class="editor" contenteditable="true" aria-label="這題的筆記…（可調字級、粗體、顏色、螢光筆、插圖）"></div>
        <div class="footer-hint">筆記會自動儲存在瀏覽器（IndexedDB / localStorage）。</div>
      </div>
    </main>

    <!-- 右：選題清單 -->
    <aside class="right panel">
      <div class="q-list" id="qList"></div>
    </aside>
  </div>

  <script src="app.js"></script>
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./service-worker.js");
    }
  </script>
</body>
</html>
